(window.webpackJsonp=window.webpackJsonp||[]).push([[421],{695:function(s,a,t){"use strict";t.r(a);var n=t(12),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"虚拟机系统的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机系统的配置"}},[s._v("#")]),s._v(" 虚拟机系统的配置")]),s._v(" "),a("h2",{attrs:{id:"使用-root-用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-root-用户"}},[s._v("#")]),s._v(" 使用 Root 用户")]),s._v(" "),a("h3",{attrs:{id:"设置-root-账户密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-root-账户密码"}},[s._v("#")]),s._v(" 设置 Root 账户密码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" root\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码如 '123456'，输入如下")]),s._v("\nEnter new UNIX password: \nRetype new UNIX password: \npasswd: password updated successfully\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"切换到-root"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换到-root"}},[s._v("#")]),s._v(" 切换到 Root")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("效果图：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ubuntu@ubuntu:~$ sudo passwd root\n[sudo] password for ubuntu: \nEnter new UNIX password: \nRetype new UNIX password: \npasswd: password updated successfully\nubuntu@ubuntu:~$ su\nPassword: \nroot@ubuntu:/home/ubuntu# \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"设置允许远程登录-root"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置允许远程登录-root"}},[s._v("#")]),s._v(" 设置允许远程登录 Root")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/ssh/sshd_config\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#LoginGraceTime 2m")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PermitRootLogin prohibit-password")]),s._v("\nPermitRootLogin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("             // 加入此行\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#StrictModes yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#MaxAuthTries 6")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#MaxSessions 10")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"重启服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启服务"}},[s._v("#")]),s._v(" 重启服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[s._v("#")]),s._v(" 同步时间")]),s._v(" "),a("ul",[a("li",[s._v("设置时区")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dpkg-reconfigure tzdata\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("选择 Asia（亚洲）")])]),s._v(" "),a("li",[a("p",[s._v("选择 Shanghai（上海）")])]),s._v(" "),a("li",[a("p",[s._v("时间同步")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 ntpdate")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置系统时间与网络时间同步（cn.pool.ntp.org 位于中国的公共 NTP 服务器）")]),s._v("\nntpdate cn.pool.ntp.org\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将系统时间写入硬件时间")]),s._v("\nhwclock "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--systohc")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("确认时间")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下（自行对照与系统时间是否一致）")]),s._v("\nWed May "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:02:29 CST "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"修改-cloud-cfg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-cloud-cfg"}},[s._v("#")]),s._v(" 修改 cloud.cfg")]),s._v(" "),a("p",[s._v("主要作用是防止重启后主机名还原")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/cloud/cloud.cfg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第 15 行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该配置默认为 false，修改为 true 即可")]),s._v("\npreserve_hostname: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"配置-dns-和-固定ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-dns-和-固定ip"}},[s._v("#")]),s._v(" 配置 DNS 和 固定IP")]),s._v(" "),a("h3",{attrs:{id:"修改-dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-dns"}},[s._v("#")]),s._v(" 修改 DNS")]),s._v(" "),a("h4",{attrs:{id:"方法一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法一"}},[s._v("#")]),s._v(" 方法一")]),s._v(" "),a("p",[s._v("停止 "),a("code",[s._v("systemd-resolved")]),s._v(" 服务："),a("code",[s._v("systemctl stop systemd-resolved")]),s._v("\n修改 DNS："),a("code",[s._v("vi /etc/resolve.conf")]),s._v("，将 "),a("code",[s._v("nameserver")]),s._v(" 修改为如 "),a("code",[s._v("114.114.114.114")]),s._v(" 可以正常使用的 "),a("code",[s._v("DNS")]),s._v(" 地址")]),s._v(" "),a("h4",{attrs:{id:"方法二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法二"}},[s._v("#")]),s._v(" 方法二")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/systemd/resolved.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("把 DNS 取消注释，添加 DNS，保存退出，重启即可")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Resolve]\nDNS=114.114.114.114    //修改此行\n#FallbackDNS=\n#Domains=\n#LLMNR=no\n#MulticastDNS=no\n#DNSSEC=no\n#Cache=yes\n#DNSStubListener=yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"修改固定-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改固定-ip"}},[s._v("#")]),s._v(" 修改固定 IP")]),s._v(" "),a("p",[s._v("编辑 "),a("code",[s._v("vi /etc/netplan/50-cloud-init.yaml")]),s._v(" 配置文件，注意这里的配置文件名未必和你机器上的相同，请根据实际情况修改。修改内容如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("network:\n    ethernets:\n        ens33:\n          addresses: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".141.134/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          gateway4: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".141.2\n          nameservers:\n            addresses: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".141.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("使配置生效")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("netplan apply\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"对虚拟机系统的额外配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对虚拟机系统的额外配置"}},[s._v("#")]),s._v(" 对虚拟机系统的额外配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("关闭交换空间：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -h")]),s._v("\n              total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G        189M        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".4G        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2M        363M        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".6G\nSwap:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G          0B        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0G\nroot@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo swapoff -a")]),s._v("\nroot@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -h")]),s._v("\n              total        used        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9G        189M        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".4G        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2M        363M        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".6G\nSwap:            0B          0B          0B\nroot@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("避免开机启动交换空间：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("注释 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/fstab"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" 中的 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("swap"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/swap.img      none    swap    sw      0       0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("关闭防火墙：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@ubuntu:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ufw disable")]),s._v("\nFirewall stopped and disabled on system startup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[s._v("#")]),s._v(" 安装 Docker")]),s._v(" "),a("h3",{attrs:{id:"卸载旧版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#卸载旧版本"}},[s._v("#")]),s._v(" 卸载旧版本")]),s._v(" "),a("ul",[a("li",[s._v("清理资源"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" system prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--volumes")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" This will remove:\n  - all stopped containers\n  - all networks not used by at least one container\n  - all volumes not used by at least one container\n  - all images without at least one container associated to them\n  - all build cache\n\nAre you sure you want to continue? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])]),s._v(" "),a("li",[s._v("卸载"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove docker.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"安装新版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装新版本"}},[s._v("#")]),s._v(" 安装新版本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"验证安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证安装"}},[s._v("#")]),s._v(" 验证安装")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出如下")]),s._v("\nClient:\n Version:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.03")]),s._v(".6\n API version:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.40")]),s._v("\n Go version:        go1.12.17\n Git commit:        369ce74a3c\n Built:             Fri Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":45:43 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n OS/Arch:           linux/amd64\n Experimental:      "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\nServer:\n Engine:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.03")]),s._v(".6\n  API version:      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.40")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("minimum version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Go version:       go1.12.17\n  Git commit:       369ce74a3c\n  Built:            Wed Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" 01:06:16 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n  OS/Arch:          linux/amd64\n  Experimental:     "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n containerd:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".3-0ubuntu1~18.04.2\n  GitCommit:        \n runc:\n  Version:          spec: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".1-dev\n  GitCommit:        \n docker-init:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.18")]),s._v(".0\n  GitCommit:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h3",{attrs:{id:"配置加速器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置加速器"}},[s._v("#")]),s._v(" 配置加速器")]),s._v(" "),a("blockquote",[a("p",[s._v("注意： 国内镜像加速器可能会很卡，请替换成你自己阿里云镜像加速器，地址如："),a("a",{attrs:{href:"https://yourself.mirror.aliyuncs.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://yourself.mirror.aliyuncs.com"),a("OutboundLink")],1),s._v("，在阿里云控制台的 容器镜像服务 -> 镜像加速器 菜单中可以找到")])]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/etc/docker/daemon.json")]),s._v(" 中写入如下内容（以下配置修改 "),a("code",[s._v("cgroup")]),s._v(" 驱动为 "),a("code",[s._v("systemd")]),s._v("，满足 "),a("code",[s._v("K8S")]),s._v(" 建议）")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("# 自定义阿里云镜像源\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"exec-opts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"log-driver"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json-file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"log-opts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max-size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100m"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://oxf7fdmw.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://dockerhub.azk8s.cn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"storage-driver"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"overlay2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("blockquote",[a("p",[s._v("注意，一定要保证该文件符合 JSON 规范，否则 Docker 将不能启动。\n验证加速器是否配置成功：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo systemctl restart docker\ndocker info\n\n# 看到这句即表示配置成功\nRegistry Mirrors:\n  https://oxf7fdmw.mirror.aliyuncs.com/\n  https://dockerhub.azk8s.cn/\n  https://registry.docker-cn.com/\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"修改主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名"}},[s._v("#")]),s._v(" 修改主机名")]),s._v(" "),a("p",[s._v("在同一局域网中主机名不应该相同，所以我们需要做修改，下列操作步骤为修改 18.04 版本的 Hostname，如果是 16.04 或以下版本则直接修改 "),a("code",[s._v("/etc/hostname")]),s._v(" 里的名称即可")]),s._v(" "),a("h4",{attrs:{id:"查看当前-hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前-hostname"}},[s._v("#")]),s._v(" 查看当前 Hostname")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前主机名")]),s._v("\nhostnamectl\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示如下内容")]),s._v("\n   Static hostname: ubuntu\n         Icon name: computer-vm\n           Chassis: vm\n        Machine ID: 33011e0a95094672b99a198eff07f652\n           Boot ID: dc856039f0d24164a9f8a50c506be96d\n    Virtualization: vmware\n  Operating System: Ubuntu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v(".2 LTS\n            Kernel: Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0-48-generic\n      Architecture: x86-64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"修改-hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-hostname"}},[s._v("#")]),s._v(" 修改 Hostname")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 hostnamectl 命令修改，其中 kubernetes-master 为新的主机名")]),s._v("\nhostnamectl set-hostname kubernetes-master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"修改-cloud-cfg-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-cloud-cfg-2"}},[s._v("#")]),s._v(" 修改 cloud.cfg")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("cloud-init package")]),s._v(" 安装了，需要修改 "),a("code",[s._v("cloud.cfg")]),s._v(" 文件。该软件包通常缺省安装用于处理 "),a("code",[s._v("cloud")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果有该文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/cloud/cloud.cfg\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该配置默认为 false，修改为 true 即可")]),s._v("\npreserve_hostname: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@kubernetes-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostnamectl")]),s._v("\n   Static hostname: kubernetes-master\n         Icon name: computer-vm\n           Chassis: vm\n        Machine ID: 33011e0a95094672b99a198eff07f652\n           Boot ID: 8c0fd75d08c644abaad3df565e6e4cbd\n    Virtualization: vmware\n  Operating System: Ubuntu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v(".2 LTS\n            Kernel: Linux "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.15")]),s._v(".0-48-generic\n      Architecture: x86-64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"配置桥接模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置桥接模式"}},[s._v("#")]),s._v(" 配置桥接模式")]),s._v(" "),a("p",[s._v("虚拟机网络连接有三种模式（Docker 容器也是大同小异）")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("桥接模式：")]),s._v(" 直接连接物理网络。对于交换机就是当前网络中真的有这么一台机器；")]),s._v(" "),a("li",[a("strong",[s._v("NAT 模式：")]),s._v(" 用于共享主机的 IP 地址。需要通过转发的方式才能连接虚拟机；")]),s._v(" "),a("li",[a("strong",[s._v("主机模式：")]),s._v(" 与主机共享的专用网络。比如主机设置了 "),a("code",[s._v("8080")]),s._v(" 端口虚拟机再设置就会冲突。")])]),s._v(" "),a("h3",{attrs:{id:"克隆虚拟机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#克隆虚拟机"}},[s._v("#")]),s._v(" 克隆虚拟机")]),s._v(" "),a("ul",[a("li",[s._v("关闭虚拟机")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("shutdown -h now\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("克隆新虚拟机")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225023.jpg",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("完整克隆虚拟机")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225024.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225020.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225022.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225021.jpg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"编辑虚拟机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑虚拟机"}},[s._v("#")]),s._v(" 编辑虚拟机")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225820.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225821.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/P-Blog/pic-repo/raw/master/images/linux/20200607225822.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);